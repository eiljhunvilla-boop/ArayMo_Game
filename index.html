<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Runner Game Deluxe</title>

<style>
*{
    box-sizing:border-box;
    -webkit-tap-highlight-color:transparent;
}

body{
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial, sans-serif;
    background:#020617;
    color:#fff;
    touch-action:manipulation;
    user-select:none;
    -webkit-user-select:none;
}

#menu,#game{
    width:360px;
    height:520px;
    background:#020617;
    border-radius:16px;
    box-shadow:0 20px 40px rgba(0,0,0,.6);
    overflow:hidden;
    position:relative;
}

#menu{
    padding:16px;
    text-align:center;
}

.characters{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:12px;
}

.char{
    border:2px solid #1e293b;
    border-radius:12px;
    padding:8px;
    cursor:pointer;
}

.char.selected{
    border-color:#22c55e;
    background:#052e16;
}

.char img{
    width:100%;
    height:90px;
    object-fit:contain;
}

button{
    margin-top:16px;
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    background:#22c55e;
    font-weight:bold;
    font-size:16px;
    cursor:pointer;
}

#hud{
    position:absolute;
    top:10px;
    width:100%;
    display:flex;
    justify-content:space-between;
    padding:0 16px;
    font-weight:bold;
    z-index:10;
}

canvas{
    display:block;
    background:#000;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
    <h2>Runner Game Deluxe</h2>
    <p>Select Character</p>

    <div class="characters">
        <div class="char" data-player="KATELYN">
            <img src="Katelyn.jpg">
            <small>KATELYN</small>
        </div>
        <div class="char" data-player="TONG2X">
            <img src="Tong.jpg">
            <small>TONG2X</small>
        </div>
    </div>

    <button id="startBtn">START GAME</button>
</div>

<!-- GAME -->
<div id="game" style="display:none">
    <div id="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Best: <span id="best">0</span></div>
    </div>
    <canvas id="canvas" width="360" height="520"></canvas>
</div>

<!-- AUDIO -->
<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="jumpSound" src="jump.mp3"></audio>
<audio id="hitSound" src="hit.mp3"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const bgImg = new Image();
bgImg.src = "bg.jpg";

let obstacleImg = new Image();

let player, obstacles, score, best, frame;
let gameOver = false;
let animationId;

let selectedPlayer = null;
let selectedPlayerImg = null;

const groundY = 420;
const gravity = 0.6;
const jumpPower = -12;
const speed = 4;

const bgm = document.getElementById("bgm");
const jumpSound = document.getElementById("jumpSound");
const hitSound = document.getElementById("hitSound");

/* CHARACTER SELECT */
document.querySelectorAll(".char").forEach(c=>{
    c.addEventListener("click", ()=>{
        document.querySelectorAll(".char").forEach(x=>x.classList.remove("selected"));
        c.classList.add("selected");

        selectedPlayer = c.dataset.player;

        if(selectedPlayer === "KATELYN"){
            selectedPlayerImg = "Katelyn.jpg";
            obstacleImg.src = "Tong.jpg";
        }else{
            selectedPlayerImg = "Tong.jpg";
            obstacleImg.src = "Katelyn.jpg";
        }
    });
});

/* BEST SCORE */
best = localStorage.getItem("runnerBest") || 0;
document.getElementById("best").innerText = best;

/* START GAME */
document.getElementById("startBtn").addEventListener("click", async ()=>{
    if(!selectedPlayer){
        alert("Select a character!");
        return;
    }

    document.getElementById("menu").style.display="none";
    document.getElementById("game").style.display="block";

    try{ await bgm.play(); }catch(e){}
    startGame();
});

function startGame(){
    cancelAnimationFrame(animationId);

    player = {
        x:60,
        y:groundY-50,
        w:42,
        h:42,
        vy:0,
        onGround:true,
        img:new Image()
    };

    player.img.src = selectedPlayerImg;

    obstacles = [];
    score = 0;
    frame = 0;
    gameOver = false;

    canvas.addEventListener("touchstart", jump, {passive:true});
    canvas.addEventListener("click", jump);

    loop();
}

/* INPUT */
function jump(){
    if(player.onGround && !gameOver){
        player.vy = jumpPower;
        player.onGround = false;
        jumpSound.currentTime = 0;
        jumpSound.play();
    }
}

document.addEventListener("keydown", e=>{
    if(e.code === "Space") jump();
});

/* GAME LOOP */
function loop(){
    if(gameOver) return;
    frame++;

    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

    ctx.fillStyle="rgba(30,41,59,0.6)";
    ctx.fillRect(0,groundY,canvas.width,100);

    player.vy += gravity;
    player.y += player.vy;

    if(player.y + player.h >= groundY){
        player.y = groundY - player.h;
        player.vy = 0;
        player.onGround = true;
    }

    ctx.drawImage(player.img,player.x,player.y,player.w,player.h);

    if(frame % 90 === 0){
        obstacles.push({x:canvas.width,w:36,h:48});
    }

    for(let o of obstacles){
        o.x -= speed;
        ctx.drawImage(obstacleImg,o.x,groundY-o.h,o.w,o.h);

        if(
            player.x < o.x + o.w &&
            player.x + player.w > o.x &&
            player.y + player.h > groundY - o.h
        ){
            endGame();
            return;
        }
    }

    obstacles = obstacles.filter(o=>o.x>-60);
    score++;
    document.getElementById("score").innerText = score;

    animationId = requestAnimationFrame(loop);
}

/* GAME OVER */
function endGame(){
    gameOver = true;
    cancelAnimationFrame(animationId);

    bgm.pause();
    hitSound.currentTime = 0;
    hitSound.play();

    if(score > best){
        best = score;
        localStorage.setItem("runnerBest",best);
    }

    ctx.fillStyle="rgba(0,0,0,0.75)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="28px Arial";
    ctx.fillText("GAME OVER",canvas.width/2,220);

    ctx.font="18px Arial";
    ctx.fillText("Score: "+score,canvas.width/2,260);
    ctx.fillText("Tap to Restart",canvas.width/2,300);

    canvas.onclick = ()=>location.reload();
}
</script>
</body>
</html>
